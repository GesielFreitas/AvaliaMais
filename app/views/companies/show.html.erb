<%= render "navbar/navbar" %>

<% if @company.logo_file_name == nil %>
  <%= image_tag("default_company_logo.png", :width => "125", :height => "125", :id => "image-company") %>
<%else%>
  <%= image_tag(@company.logo.url(:default), :width => "125", :height => "125", :id => "image-company") %>
<%end%>

<% if @company.authenticated != true %>
  <%= image_tag("no_verified.png", :width => "40", :height => "40", :id => "image-verified") %>
<%else%>
  <%= image_tag("verified.png", :width => "40", :height => "40", :id => "image-verified") %>
<%end%>

<div id="name_company">
  <h1><%= @company.name %></h1>
</div>

<div id="info_empresa">
  <%= @company.telephone %></br>
  <%= @company.email %></br>
</div>

<div id="name_segment">
  <h2><%= @company.segment.name %></h2>
</div>

<div class="container">
  <div class="btn-group">
    <div class="btn avaliacao">Avaliações</div>
    <div class="btn geral">Geral</div>
    <div class="btn forum">Fórum</div>
    <div class="btn faq">FAQ</div>
  </div>
</div>


<% if flash[:notice] -%>
    <p class="error"><%= flash[:notice] %></p>
<% end -%>

<section id="avaliacao">

  <%if logged_in? %> 
    <div class="barra">

      <div class="estrelas">
        <div id="check-response">
          A empresa respondeu as reclamações?
            Sim  <input type="radio" class="response-radio" id="button-group">
            Não<input type="radio" class="response-radio" id="button-group">
        </div></br></br></br></br>
        <span id="message-evaluation">
          Tempo de resposta da empresa:
        </span>
          <%= form_for(:response, url: response_time_path) do |f|%>
            <%= f.hidden_field :user_id, :value => current_user.id%>
            <%= f.hidden_field :company_id, :value => @company.id%>
            <%= f.number_field :response_time, :min => 0, :step => 1, :value => @current_evaluation.response_time, :id => "response-field"%>
            <%= f.submit 'Submeter', :class => "btn btn-primary btn-sm"%>
          <%end%>
          </br></br></br>
        <span id="message-evaluation">
          Avaliação geral:
        </span>
          <% for rates in 1..5 do %> 
            <%= form_for(:evaluations, url: rate_path) do |f|%>
              <%= f.hidden_field :rate, :value => rates%>
              <%= f.hidden_field :user_id, :value => current_user.id%>
              <%= f.hidden_field :company_id, :value => @company.id%>
              <%= f.submit 'Rates', :type => :image, :src => image_path("starpng.png"), :class => "star", :id => rates%>
            <%end%>
          <%end%>
      </div>
      
  <%else%>
      <div class="estrelas">
        <p>Para avaliar uma empresa é necessário realizar login.</p>
      </div>
    </div> 
  <%end%>
</section>

<section id="forum">
  <p>Fórum da Empresa - Não Implementado</p> 
</section>

<section id="faq">
  <p>FAQ da Empresa - Não Implementado</p> 
</section>

<section id="description">
  <% if @company.description == nil || @company.description == "" %>
    <p>Essa empresa não possui uma descrição.</p>
  <%else%>
    <p><%= @company.description %></p>
  <%end%>
  

</section>


<script>
  var current_rate  =  <%= @current_evaluation.rate%>;
  if(current_rate > 0){
    for (var i = 0; i < current_rate; i++) {
      $('.star:eq('+i+')').addClass('full');
    }
  }

  $(".avaliacao").click(function(){
    $("#description").hide("slow");
    $("#forum").hide("slow");
    $("#faq").hide("slow");
    $("#avaliacao").show("slow");
  });
  $(".geral").click(function(){
    $("#avaliacao").hide("slow");
    $("#forum").hide("slow");
    $("#faq").hide("slow");
    $("#description").show("slow");
  });
  $(".forum").click(function(){
    $("#avaliacao").hide("slow");
    $("#faq").hide("slow");
    $("#description").hide("slow");
    $("#forum").show("slow");
  });
  $(".faq").click(function(){
    $("#avaliacao").hide("slow");
    $("#forum").hide("slow");
    $("#description").hide("slow");
    $("#faq").show("slow");
  });

  $('.star').on('click', function(){
    var ponto = $(this).attr('id');
    for (var i = 0; i <= indice; i++) {
      $('.star:eq('+i+')').addClass('full');
    }
    
  });

</script>